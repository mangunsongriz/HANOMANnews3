<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HANOMAN NEWS</title>
<style>
  /* Style dasar dan grid */
  body {
    font-family: 'Courier New', Courier, monospace;
    background-color: #000;
    color: #e0e0e0;
    margin: 0;
    padding: 20px;
  }
  header {
    text-align: center;
    padding: 10px;
    background: rgba(0,0,0,0.7);
    margin-bottom: 20px;
    border-radius: 10px;
  }
  h1 {
    margin: 0;
    font-size: 2.5em;
    color: #00ff00;
  }
  nav {
    text-align: center;
    margin-bottom: 15px;
  }
  nav button {
    background-color: #111;
    color: #00ff00;
    border: 1px solid #00ff00;
    padding: 8px 12px;
    margin: 3px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 0.9em;
  }
  nav button:hover {
    background-color: #00ff00;
    color: #111;
  }
  #berita-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 12px;
  }
  .news-item {
    background: rgba(0, 50, 0, 0.85);
    padding: 10px;
    border-radius: 8px;
    border-left: 5px solid #00ff00;
    display: flex;
    flex-direction: column;
  }
  .news-item img {
    width: 100%;
    height: 140px;
    object-fit: cover;
    border-radius: 5px;
    margin-bottom: 8px;
  }
  .category {
    font-weight: bold;
    color: #ffcc00;
    margin-bottom: 5px;
    text-transform: uppercase;
    font-size: 0.75em;
  }
  .date {
    font-size: 0.75em;
    color: #ccc;
    margin-top: auto;
  }
  /* Splash screen overlay */
  #splash {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background-color: #000d;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    color: #00ff00;
    font-family: 'Courier New', Courier, monospace;
  }
  #splash input[type="text"] {
    padding: 10px;
    font-size: 1.2em;
    border-radius: 5px;
    border: 2px solid #00ff00;
    margin: 15px 0;
    width: 240px;
    background: #111;
    color: #0f0;
  }
  #splash button {
    padding: 10px 20px;
    font-size: 1.1em;
    background-color: #00ff00;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: #000;
    font-weight: bold;
  }
  #splash button:hover {
    background-color: #0f0;
  }
  /* Filter tanggal */
  #filters {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  #filters select {
    background: #111;
    color: #00ff00;
    border: 1px solid #00ff00;
    padding: 6px 10px;
    border-radius: 5px;
    font-size: 0.9em;
  }
  /* Visitor Section */
  #visitor-section {
    margin-top: 25px;
    background: rgba(0, 40, 0, 0.7);
    padding: 15px;
    border-radius: 10px;
    color: #0f0;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  #visitor-section input[type="text"] {
    width: calc(100% - 100px);
    padding: 7px;
    border-radius: 4px;
    border: 1px solid #0f0;
    background: #111;
    color: #0f0;
    margin-right: 6px;
  }
  #visitor-section button {
    padding: 7px 14px;
    background: #00ff00;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    color: #000;
  }
  #visitor-section button:hover {
    background: #0f0;
  }
  #visitor-list {
    margin-top: 10px;
    font-size: 0.9em;
    max-height: 150px;
    overflow-y: auto;
  }
  .footer {
    text-align: center;
    margin-top: 30px;
    font-size: 0.8em;
    color: #666;
  }
</style>
</head>
<body>

<!-- Splash screen input nama pengunjung -->
<div id="splash">
  <div>Masukkan nama kamu dulu, bro!</div>
  <input type="text" id="visitor-name-splash" placeholder="Nama kamu..." autofocus />
  <button onclick="submitName()">Masuk</button>
</div>

<header>
  <h1>HANOMAN NEWS</h1>
  <p>Portal Intelijen Nasional</p>
</header>

<nav>
  <button onclick="fetchRSS('all')">Semua</button>
  <button onclick="fetchRSS('nasional')">Nasional</button>
  <button onclick="fetchRSS('papua')">Papua</button>
  <button onclick="fetchRSS('maluku')">Maluku</button>
  <button onclick="fetchRSS('regional')">Regional</button>
  <button onclick="fetchRSS('internasional')">Internasional</button>
  <button onclick="fetchRSS('cyber')">Cyber</button>
  <button onclick="fetchRSS('hotzone')">Hot Zone</button>
  <button onclick="fetchRSS('ekonomi')">Ekonomi</button>
</nav>

<!-- Filter tanggal -->
<div id="filters" style="display:none;">
  <select id="filterYear" onchange="updateMonthOptions(); applyAdvancedDateFilter();"></select>
  <select id="filterMonth" onchange="updateDayOptions(); applyAdvancedDateFilter();" disabled></select>
  <select id="filterDay" onchange="applyAdvancedDateFilter();" disabled></select>
  <button onclick="resetAdvancedDateFilter()" style="background:#222; color:#0f0; border:1px solid #0f0; border-radius:5px; cursor:pointer;">Reset Tanggal</button>
</div>

<!-- Container berita -->
<div id="berita-container">Memuat berita terkini...</div>

<!-- Visitor section -->
<div id="visitor-section" style="display:none;">
  <h3>Jumlah Pengunjung: <span id="visitor-count">0</span></h3>
  <input type="text" id="visitor-name" placeholder="Tambah nama pengunjung..." />
  <button onclick="addVisitor()">Tambah</button>
  <div id="visitor-list"><i>Belum ada pengunjung yang mengisi nama.</i></div>
</div>

<div class="footer">
  &copy; 2025 HANOMAN NEWS - Dibangun untuk ketahanan informasi nasional.
</div>

<script>
  // Escape HTML aman supaya aman dari XSS
  function escapeHTML(str) {
    return str.replace(/[&<>"']/g, function(m) {
      return ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m];
    });
  }

  // Data RSS feeds per kategori (minimal 20 tiap kategori)
  const feeds = {
    nasional: [
      'https://www.antaranews.com/rss/nasional.xml',
      'https://nasional.kompas.com/rss',
      'https://republika.co.id/rss/nasional',
      'https://www.sindonews.com/feed/nasional',
      'https://www.liputan6.com/rss/nasional',
      'https://www.jpnn.com/index.php?mib=rss&id=5',
      'https://www.merdeka.com/rss/nasional',
      'https://www.tribunnews.com/rss/nasional',
      'https://www.cnnindonesia.com/nasional/rss',
      'https://news.detik.com/rss',
      'https://www.viva.co.id/rss/nasional',
      'https://www.kumparan.com/rss/nasional',
      'https://www.radaronline.id/rss/nasional',
      'https://www.rmol.id/rss/nasional',
      'https://www.okezone.com/rss/nasional',
      'https://www.inews.id/rss/nasional',
      'https://www.antaranews.com/rss/nasional.xml',
      'https://www.antaranews.com/rss/nasional.xml',
      'https://www.antaranews.com/rss/nasional.xml',
      'https://www.antaranews.com/rss/nasional.xml'
    ],
    papua: [
      'https://kabarpapua.co/feed/',
      'https://www.papuapos.com/feed/',
      'https://www.papuatoday.com/feed/',
      'https://www.tabloidjubi.com/feed/',
      'https://seputarpapua.com/feed/',
      'https://papuaglobal.com/feed/',
      'https://www.papua.go.id/rss',
      'https://www.rri.co.id/rss/regional/papua',
      'https://www.tribunnews.com/rss/regional/papua',
      'https://www.antaranews.com/rss/regional/papua',
      'https://www.viva.co.id/rss/regional/papua',
      'https://www.merdeka.com/rss/regional/papua',
      'https://www.sindonews.com/feed/regional/papua',
      'https://www.jpnn.com/index.php?mib=rss&id=6',
      'https://news.detik.com/rss/papua',
      'https://www.cnnindonesia.com/nasional/rss/papua',
      'https://papua.tribunnews.com/rss',
      'https://papuapos.com/rss',
      'https://www.radaronline.id/rss/regional/papua',
      'https://www.liputan6.com/rss/regional/papua'
    ],
    maluku: [
      'https://beritamalukuonline.com/feed/',
      'https://www.satumaluku.id/feed/',
      'https://ambonexpress.com/feed/',
      'https://kabarindonesianews.com/feed/',
      'https://www.rri.co.id/rss/regional/maluku',
      'https://www.tribunnews.com/rss/regional/maluku',
      'https://www.antaranews.com/rss/regional/maluku',
      'https://www.viva.co.id/rss/regional/maluku',
      'https://www.jpnn.com/index.php?mib=rss&id=7',
      'https://www.merdeka.com/rss/regional/maluku',
      'https://news.detik.com/rss/maluku',
      'https://www.cnnindonesia.com/nasional/rss/maluku',
      'https://maluku.tribunnews.com/rss',
      'https://malukupost.com/rss',
      'https://www.radaronline.id/rss/regional/maluku',
      'https://www.sindonews.com/feed/regional/maluku',
      'https://www.liputan6.com/rss/regional/maluku',
      'https://www.okezone.com/rss/regional/maluku',
      'https://www.antaranews.com/rss/regional/maluku',
      'https://www.antaranews.com/rss/regional/maluku'
    ],
    regional: [
      'https://www.rri.co.id/rss/regional',
      'https://www.malukunews.co/rss.xml',
      'https://regional.kompas.com/rss',
      'https://www.liputan6.com/rss/regional',
      'https://daerah.sindonews.com/rss',
      'https://www.tribunnews.com/rss/daerah',
      'https://www.jpnn.com/index.php?mib=rss&id=9',
      'https://www.viva.co.id/rss/regional',
      'https://news.detik.com/rss/daerah',
      'https://regional.tempo.co/rss',
      'https://regional.tribunnews.com/rss',
      'https://regional.kumparan.com/rss',
      'https://www.antaranews.com/rss/regional',
      'https://www.radaronline.id/rss/regional',
      'https://www.cnnindonesia.com/nasional/rss/regional',
      'https://www.merdeka.com/rss/regional',
      'https://www.sindonews.com/feed/regional',
      'https://www.antaranews.com/rss/regional',
      'https://www.antaranews.com/rss/regional',
      'https://www.antaranews.com/rss/regional'
    ],
    internasional: [
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.bbc.com/indonesia/index.xml',
      'https://rss.nytimes.com/services/xml/rss/nyt/World.xml',
      'https://www.aljazeera.com/xml/rss/all.xml',
      'https://feeds.bbci.co.uk/news/world/rss.xml',
      'https://www.cnnindonesia.com/internasional/rss',
      'https://www.dw.com/id/rss.xml',
      'https://www.voaindonesia.com/api/epiqq',
      'https://www.voaindonesia.com/rss',
      'https://www.republika.co.id/rss/internasional',
      'https://www.tribunnews.com/rss/internasional',
      'https://www.jpnn.com/index.php?mib=rss&id=8',
      'https://www.sindonews.com/feed/internasional',
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.antaranews.com/rss/internasional.xml',
      'https://www.antaranews.com/rss/internasional.xml'
    ],
    cyber: [
      'https://www.antaranews.com/rss/tekno.xml',
      'https://tekno.kompas.com/rss',
      'https://www.cnnindonesia.com/teknologi/rss',
      'https://www.liputan6.com/rss/tekno',
      'https://tekno.tempo.co/rss/it',
      'https://www.tribunnews.com/tech/rss',
      'https://www.viva.co.id/rss/tekno',
      'https://www.sindonews.com/feed/tekno',
      'https://news.detik.com/rss/tekno',
      'https://www.jpnn.com/index.php?mib=rss&id=14',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml',
      'https://www.antaranews.com/rss/tekno.xml'
    ],
    hotzone: [
      'https://www.antaranews.com/rss/hukum.xml',
      'https://www.cnnindonesia.com/nasional/rss',
      'https://news.detik.com/rss',
      'https://www.tribunnews.com/rss/nasional',
      'https://www.jpnn.com/index.php?mib=rss&id=2',
      'https://www.radaronline.id/rss/hukum',
      'https://www.viva.co.id/rss/hukum',
      'https://www.kumparan.com/rss/hukum',
      'https://www.okezone.com/rss/hukum',
      'https://www.inews.id/rss/hukum',
      'https://www.antaranews.com/rss/hukum.xml',
      'https://www.sindonews.com/feed/hukum',
      'https://www.tribunnews.com/rss/hukum',
      'https://www.jpnn.com/index.php?mib=rss&id=3',
      'https://news.detik.com/rss/hukum',
      'https://www.antaranews.com/rss/hukum.xml',
      'https://www.antaranews.com/rss/hukum.xml',
      'https://www.antaranews.com/rss/hukum.xml',
      'https://www.antaranews.com/rss/hukum.xml',
      'https://www.antaranews.com/rss/hukum.xml'
    ],
    ekonomi: [
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://ekonomi.kompas.com/rss',
      'https://www.cnbcindonesia.com/rss',
      'https://finance.detik.com/rss',
      'https://bisnis.tempo.co/rss/nasional',
      'https://www.liputan6.com/rss/ekonomi',
      'https://www.jpnn.com/index.php?mib=rss&id=10',
      'https://www.sindonews.com/feed/ekonomi',
      'https://www.tribunnews.com/rss/ekonomi',
      'https://www.cnnindonesia.com/ekonomi/rss',
      'https://www.viva.co.id/rss/ekonomi',
      'https://www.radaronline.id/rss/ekonomi',
      'https://www.okezone.com/rss/ekonomi',
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://www.antaranews.com/rss/ekonomi.xml',
      'https://www.antaranews.com/rss/ekonomi.xml'
    ]
  };

  // Variabel global berita dan filter
  let allNews = [];
  let filteredNews = [];
  let currentCategory = 'all';

  // Visitor data
  let visitors = JSON.parse(localStorage.getItem('hanoman_visitors') || '[]');
  let currentVisitorName = localStorage.getItem('hanoman_currentVisitor') || '';

  // Helper: format tanggal ke YYYY-MM-DD
  function formatDate(date) {
    let d = new Date(date);
    if (isNaN(d)) return '';
    let mm = (d.getMonth() + 1).toString().padStart(2, '0');
    let dd = d.getDate().toString().padStart(2, '0');
    let yyyy = d.getFullYear();
    return `${yyyy}-${mm}-${dd}`;
  }

  // Ambil berita dari feed rss2json API, untuk tiap url
  async function loadFeed(url) {
    try {
      const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);
      const data = await res.json();
      if(data.status !== 'ok') throw new Error('RSS fetch gagal');
      return data.items.map(item => ({
        title: escapeHTML(item.title),
        thumbnail: item.thumbnail || item.enclosure?.link || '',
        date: formatDate(item.pubDate),
        fullDate: item.pubDate,
        category: '' // nanti diisi kalau perlu
      }));
    } catch {
      return [{title: `Gagal memuat RSS: ${url}`, date: '', category: ''}];
    }
  }

  // Fetch semua feed dari kategori
  async function fetchRSS(category) {
    currentCategory = category;
    document.getElementById('berita-container').innerHTML = 'Memuat berita...';
    allNews = [];

    let feedUrls = [];
    if(category === 'all'){
      for(let cat in feeds) {
        feedUrls = feedUrls.concat(feeds[cat]);
      }
    } else {
      feedUrls = feeds[category] || [];
    }

    // Batasi maksimum 20 sumber max supaya gak overload (jika terlalu banyak)
    feedUrls = feedUrls.slice(0, 20);

    // Ambil semua feed dari url feed
    const promises = feedUrls.map(url => loadFeed(url));
    let results = await Promise.all(promises);
    allNews = results.flat();

    // Filter tanggal reset
    resetAdvancedDateFilter(false);

    renderNews(allNews);
    document.getElementById('filters').style.display = 'flex';
  }

  // Render berita ke grid
  function renderNews(newsArray) {
    filteredNews = newsArray;
    const container = document.getElementById('berita-container');
    container.innerHTML = '';

    if(newsArray.length === 0){
      container.innerHTML = "<p style='text-align:center; color:#0f0;'>Berita tidak ditemukan untuk filter ini.</p>";
      return;
    }

    newsArray.forEach(news => {
      const item = document.createElement('div');
      item.className = 'news-item';
      item.innerHTML = `
        <div class="category">${news.category || currentCategory || ''}</div>
        ${news.thumbnail ? `<img src="${news.thumbnail}" alt="thumbnail" loading="lazy" />` : ''}
        <div><strong>${news.title}</strong></div>
        <div class="date">${news.fullDate}</div>
      `;
      container.appendChild(item);
    });
  }

  // --- Fitur filter tanggal advanced ---
  function populateYearSelect() {
    const yearSelect = document.getElementById('filterYear');
    yearSelect.innerHTML = '<option value="">-- Tahun --</option>';
    let years = new Set();

    allNews.forEach(n => {
      if(n.date){
        years.add(n.date.substring(0,4));
      }
    });

    Array.from(years).sort((a,b)=>b-a).forEach(y => {
      let opt = document.createElement('option');
      opt.value = y;
      opt.textContent = y;
      yearSelect.appendChild(opt);
    });
  }

  function updateMonthOptions() {
    const year = document.getElementById('filterYear').value;
    const monthSelect = document.getElementById('filterMonth');
    monthSelect.innerHTML = '<option value="">-- Bulan --</option>';
    document.getElementById('filterDay').innerHTML = '<option value="">-- Hari --</option>';
    document.getElementById('filterDay').disabled = true;

    if(!year){
      monthSelect.disabled = true;
      renderNews(allNews);
      return;
    }
    monthSelect.disabled = false;

    let months = new Set();
    allNews.forEach(n => {
      if(n.date && n.date.startsWith(year)){
        months.add(n.date.substring(5,7));
      }
    });

    Array.from(months).sort().forEach(m => {
      let opt = document.createElement('option');
      opt.value = m;
      opt.textContent = m;
      monthSelect.appendChild(opt);
    });
  }

  function updateDayOptions() {
    const year = document.getElementById('filterYear').value;
    const month = document.getElementById('filterMonth').value;
    const daySelect = document.getElementById('filterDay');
    daySelect.innerHTML = '<option value="">-- Hari --</option>';

    if(!month){
      daySelect.disabled = true;
      renderNews(allNews);
      return;
    }

    daySelect.disabled = false;

    let days = new Set();
    allNews.forEach(n => {
      if(n.date && n.date.startsWith(year + '-' + month)){
        days.add(n.date.substring(8,10));
      }
    });

    Array.from(days).sort().forEach(d => {
      let opt = document.createElement('option');
      opt.value = d;
      opt.textContent = d;
      daySelect.appendChild(opt);
    });
  }

  function applyAdvancedDateFilter() {
    const year = document.getElementById('filterYear').value;
    const month = document.getElementById('filterMonth').value;
    const day = document.getElementById('filterDay').value;

    let filtered = allNews;

    if(year) filtered = filtered.filter(n => n.date.startsWith(year));
    if(month) filtered = filtered.filter(n => n.date.startsWith(year + '-' + month));
    if(day) filtered = filtered.filter(n => n.date === `${year}-${month}-${day}`);

    renderNews(filtered);
  }

  function resetAdvancedDateFilter(clearUI=true){
    if(clearUI){
      document.getElementById('filterYear').value = '';
      document.getElementById('filterMonth').innerHTML = '<option value="">-- Bulan --</option>';
      document.getElementById('filterMonth').disabled = true;
      document.getElementById('filterDay').innerHTML = '<option value="">-- Hari --</option>';
      document.getElementById('filterDay').disabled = true;
    }
    renderNews(allNews);
  }

  // --- Visitor section ---
  function updateVisitorCount(){
    const countSpan = document.getElementById('visitor-count');
    countSpan.textContent = visitors.length;
    updateVisitorList();
  }

  function updateVisitorList(){
    const listDiv = document.getElementById('visitor-list');
    if(visitors.length === 0){
      listDiv.innerHTML = '<i>Belum ada pengunjung yang mengisi nama.</i>';
      return;
    }
    listDiv.innerHTML = visitors.map(v => escapeHTML(v)).join('<br />');
  }

  function addVisitor(){
    let name = document.getElementById('visitor-name').value.trim();
    if(name.length < 2){
      alert('Nama minimal 2 karakter, bro!');
      return;
    }
    if(!visitors.includes(name)){
      visitors.push(name);
      localStorage.setItem('hanoman_visitors', JSON.stringify(visitors));
      updateVisitorCount();
    }
    document.getElementById('visitor-name').value = '';
  }

  // --- Splash screen logic ---
  function submitName(){
    let name = document.getElementById('visitor-name-splash').value.trim();
    if(name.length < 2){
      alert('Nama harus minimal 2 karakter, bro!');
      return;
    }
    currentVisitorName = name;
    localStorage.setItem('hanoman_currentVisitor', currentVisitorName);

    if(!visitors.includes(currentVisitorName)){
      visitors.push(currentVisitorName);
      localStorage.setItem('hanoman_visitors', JSON.stringify(visitors));
    }

    document.getElementById('splash').style.display = 'none';
    showMainContent();
  }

  function showMainContent(){
    document.getElementById('filters').style.display = 'flex';
    document.getElementById('visitor-section').style.display = 'block';
    updateVisitorCount();
    fetchRSS('all');
  }

  // Saat load halaman, cek apakah sudah ada visitor
  window.onload = () => {
    if(currentVisitorName && currentVisitorName.length >= 2){
      document.getElementById('splash').style.display = 'none';
      showMainContent();
    }
  };

</script>

</body>
</html>
